name: Smoke (API/CORS)
on:
  workflow_dispatch:
permissions:
  contents: read

jobs:
  smoke:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout (no submodules)
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v4.2.2
        with:
          fetch-depth: 0
          submodules: false
      - name: Run smoke tests
        working-directory: istampit-auth
        env:
          AUTH_ORIGIN: https://auth.istampit.io
          MARKETING_ORIGIN: https://www.istampit.io
        run: |
          command -v curl >/dev/null 2>&1 || { echo "curl missing"; exit 1; }
          chmod +x scripts/smoke-auth.sh
          ./scripts/smoke-auth.sh
